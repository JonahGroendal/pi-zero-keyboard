<!DOCTYPE html>
<html class="fontawesome-i2svg-active fontawesome-i2svg-complete"><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <style type="text/css">svg:not(:root).svg-inline--fa{overflow:visible}.svg-inline--fa{display:inline-block;font-size:inherit;height:1em;overflow:visible;vertical-align:-.125em}.svg-inline--fa.fa-lg{vertical-align:-.225em}.svg-inline--fa.fa-w-1{width:.0625em}.svg-inline--fa.fa-w-2{width:.125em}.svg-inline--fa.fa-w-3{width:.1875em}.svg-inline--fa.fa-w-4{width:.25em}.svg-inline--fa.fa-w-5{width:.3125em}.svg-inline--fa.fa-w-6{width:.375em}.svg-inline--fa.fa-w-7{width:.4375em}.svg-inline--fa.fa-w-8{width:.5em}.svg-inline--fa.fa-w-9{width:.5625em}.svg-inline--fa.fa-w-10{width:.625em}.svg-inline--fa.fa-w-11{width:.6875em}.svg-inline--fa.fa-w-12{width:.75em}.svg-inline--fa.fa-w-13{width:.8125em}.svg-inline--fa.fa-w-14{width:.875em}.svg-inline--fa.fa-w-15{width:.9375em}.svg-inline--fa.fa-w-16{width:1em}.svg-inline--fa.fa-w-17{width:1.0625em}.svg-inline--fa.fa-w-18{width:1.125em}.svg-inline--fa.fa-w-19{width:1.1875em}.svg-inline--fa.fa-w-20{width:1.25em}.svg-inline--fa.fa-pull-left{margin-right:.3em;width:auto}.svg-inline--fa.fa-pull-right{margin-left:.3em;width:auto}.svg-inline--fa.fa-border{height:1.5em}.svg-inline--fa.fa-li{width:2em}.svg-inline--fa.fa-fw{width:1.25em}.fa-layers svg.svg-inline--fa{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.fa-layers{display:inline-block;height:1em;position:relative;text-align:center;vertical-align:-.125em;width:1em}.fa-layers svg.svg-inline--fa{-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter,.fa-layers-text{display:inline-block;position:absolute;text-align:center}.fa-layers-text{left:50%;top:50%;-webkit-transform:translate(-50%,-50%);transform:translate(-50%,-50%);-webkit-transform-origin:center center;transform-origin:center center}.fa-layers-counter{background-color:#ff253a;border-radius:1em;-webkit-box-sizing:border-box;box-sizing:border-box;color:#fff;height:1.5em;line-height:1;max-width:5em;min-width:1.5em;overflow:hidden;padding:.25em;right:0;text-overflow:ellipsis;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-bottom-right{bottom:0;right:0;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom right;transform-origin:bottom right}.fa-layers-bottom-left{bottom:0;left:0;right:auto;top:auto;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:bottom left;transform-origin:bottom left}.fa-layers-top-right{right:0;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top right;transform-origin:top right}.fa-layers-top-left{left:0;right:auto;top:0;-webkit-transform:scale(.25);transform:scale(.25);-webkit-transform-origin:top left;transform-origin:top left}.fa-lg{font-size:1.3333333333em;line-height:.75em;vertical-align:-.0667em}.fa-xs{font-size:.75em}.fa-sm{font-size:.875em}.fa-1x{font-size:1em}.fa-2x{font-size:2em}.fa-3x{font-size:3em}.fa-4x{font-size:4em}.fa-5x{font-size:5em}.fa-6x{font-size:6em}.fa-7x{font-size:7em}.fa-8x{font-size:8em}.fa-9x{font-size:9em}.fa-10x{font-size:10em}.fa-fw{text-align:center;width:1.25em}.fa-ul{list-style-type:none;margin-left:2.5em;padding-left:0}.fa-ul>li{position:relative}.fa-li{left:-2em;position:absolute;text-align:center;width:2em;line-height:inherit}.fa-border{border:solid .08em #eee;border-radius:.1em;padding:.2em .25em .15em}.fa-pull-left{float:left}.fa-pull-right{float:right}.fa.fa-pull-left,.fab.fa-pull-left,.fal.fa-pull-left,.far.fa-pull-left,.fas.fa-pull-left{margin-right:.3em}.fa.fa-pull-right,.fab.fa-pull-right,.fal.fa-pull-right,.far.fa-pull-right,.fas.fa-pull-right{margin-left:.3em}.fa-spin{-webkit-animation:fa-spin 2s infinite linear;animation:fa-spin 2s infinite linear}.fa-pulse{-webkit-animation:fa-spin 1s infinite steps(8);animation:fa-spin 1s infinite steps(8)}@-webkit-keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes fa-spin{0%{-webkit-transform:rotate(0);transform:rotate(0)}100%{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}.fa-rotate-90{-webkit-transform:rotate(90deg);transform:rotate(90deg)}.fa-rotate-180{-webkit-transform:rotate(180deg);transform:rotate(180deg)}.fa-rotate-270{-webkit-transform:rotate(270deg);transform:rotate(270deg)}.fa-flip-horizontal{-webkit-transform:scale(-1,1);transform:scale(-1,1)}.fa-flip-vertical{-webkit-transform:scale(1,-1);transform:scale(1,-1)}.fa-flip-both,.fa-flip-horizontal.fa-flip-vertical{-webkit-transform:scale(-1,-1);transform:scale(-1,-1)}:root .fa-flip-both,:root .fa-flip-horizontal,:root .fa-flip-vertical,:root .fa-rotate-180,:root .fa-rotate-270,:root .fa-rotate-90{-webkit-filter:none;filter:none}.fa-stack{display:inline-block;height:2em;position:relative;width:2.5em}.fa-stack-1x,.fa-stack-2x{bottom:0;left:0;margin:auto;position:absolute;right:0;top:0}.svg-inline--fa.fa-stack-1x{height:1em;width:1.25em}.svg-inline--fa.fa-stack-2x{height:2em;width:2.5em}.fa-inverse{color:#fff}.sr-only{border:0;clip:rect(0,0,0,0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}.sr-only-focusable:active,.sr-only-focusable:focus{clip:auto;height:auto;margin:0;overflow:visible;position:static;width:auto}.svg-inline--fa .fa-primary{fill:var(--fa-primary-color,currentColor);opacity:1;opacity:var(--fa-primary-opacity,1)}.svg-inline--fa .fa-secondary{fill:var(--fa-secondary-color,currentColor);opacity:.4;opacity:var(--fa-secondary-opacity,.4)}.svg-inline--fa.fa-swap-opacity .fa-primary{opacity:.4;opacity:var(--fa-secondary-opacity,.4)}.svg-inline--fa.fa-swap-opacity .fa-secondary{opacity:1;opacity:var(--fa-primary-opacity,1)}.svg-inline--fa mask .fa-primary,.svg-inline--fa mask .fa-secondary{fill:#000}.fad.fa-inverse{color:#fff}</style><link rel="icon" type="image/png" sizes="16x16" href="https://www.rmedgar.com/favicon-16x16.png">

    <title>Using RPi Zero as a Keyboard Part 3: Sending and receiving reports | rmed</title>

        <link rel="stylesheet" type="text/css" href="Tutorial-Part-3-Sending-and-receiving-reports_files/style.css">

    <meta charset="utf-8">
    <meta name="distribution" content="global">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta property="og:site_name" content="rmed">
    <meta name="twitter:card" content="summary">
<meta property="og:title" content="Using RPi Zero as a Keyboard Part 3: Sending and receiving reports">
<meta property="og:type" content="article">
<meta property="og:url" content="blog/using-rpi-zero-as-keyboard-send-reports">
<meta property="og:description" content="In this third and last part of the series we will use the new keyboard to send keystrokes to the connected computer. To do this, I will provide a couple of examples using Bash and Python, although they can be easily translated to other languages. Edited July 8, 2018: Tested â€¦">
<meta property="og:locale" content="en">
<meta property="article:published_time" content="2017-07-13 11:40:14+02:00">
<meta property="article:modified_time" content="2017-07-13 11:40:14+02:00">
<meta property="article:author" content="rmed"><meta property="article:tag" content="hid"><meta property="article:tag" content="linux"><meta property="article:tag" content="input"><meta property="article:tag" content="descriptor"><meta property="article:tag" content="zero"><meta property="article:tag" content="keyboard"><meta property="article:tag" content="pi"><meta property="article:tag" content="rpi"><meta property="article:tag" content="report"><meta property="article:tag" content="keys"><meta property="article:tag" content="output"><meta property="article:tag" content="raspberry pi">
<script type="text/javascript" async="" src="Tutorial-Part-3-Sending-and-receiving-reports_files/matomo.js"></script><script type="text/javascript">
  var _paq = window._paq = window._paq || [];
  _paq.push(["disableCookies"]);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//stats.rmedgar.com/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
        <script type="text/javascript" src="Tutorial-Part-3-Sending-and-receiving-reports_files/main.js" charset="utf-8"></script>

        <script type="module" src="Tutorial-Part-3-Sending-and-receiving-reports_files/fa.js" charset="utf-8"></script>

<script src="Tutorial-Part-3-Sending-and-receiving-reports_files/embed.js" defer="defer"></script><style></style></head>

<body><div role="dialog" aria-live="polite" aria-label="cookieconsent" aria-describedby="cookieconsent:desc" class="cc-window cc-floating cc-type-info cc-theme-block cc-bottom cc-right cc-color-override-1396553019 " style=""><!--googleoff: all--><span id="cookieconsent:desc" class="cc-message">This
 website gathers anonymous statistics, which you may opt-out of at any 
time, and may optionally store personal information when publishing 
comments. <a aria-label="learn more about cookies" role="button" tabindex="0" class="cc-link" href="https://www.rmedgar.com/privacy" rel="noopener noreferrer nofollow" target="_blank">Learn more</a></span><div class="cc-compliance"><a aria-label="dismiss cookie message" role="button" tabindex="0" class="cc-btn cc-dismiss">Ok</a></div><!--googleon: all--></div>
    <section class="hero is-dark with-navbar">
        <div class="hero-body">
            <div class="container">
                <div id="social-links">
                        <a class="is-size-3" href="https://github.com/rmed" target="_blank">
                            <svg class="svg-inline--fa fa-github fa-w-16" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="github" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512" data-fa-i2svg=""><path fill="currentColor" d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path></svg><!-- <i class="fab fa-github"></i> Font Awesome fontawesome.com -->
                        </a>
                        <a class="is-size-3" href="https://twitter.com/rmed_dev" target="_blank">
                            <svg class="svg-inline--fa fa-twitter fa-w-16" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="twitter" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" data-fa-i2svg=""><path fill="currentColor" d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"></path></svg><!-- <i class="fab fa-twitter"></i> Font Awesome fontawesome.com -->
                        </a>
                        <a class="is-size-3" href="https://linkedin.com/in/rmedgar" target="_blank">
                            <svg class="svg-inline--fa fa-linkedin fa-w-14" aria-hidden="true" focusable="false" data-prefix="fab" data-icon="linkedin" role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512" data-fa-i2svg=""><path fill="currentColor" d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"></path></svg><!-- <i class="fab fa-linkedin"></i> Font Awesome fontawesome.com -->
                        </a>
                </div>
                <h1 class="title">rmed</h1>
                <h2 class="subtitle">blog</h2>
            </div>
        </div>
    </section>

    <nav class="navbar is-primary mb-4" role="navigation" aria-label="main navigation">
        <div class="container">
            <div class="navbar-brand">
                <a id="navbar-toggle" class="navbar-burger burger" aria-label="menu" aria-expanded="false" data-target="nav-menu">
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                    <span aria-hidden="true"></span>
                </a>
            </div>

            <div id="nav-menu" class="navbar-menu">
                <div class="navbar-start">
                        <a class="navbar-item" href="https://www.rmedgar.com/">Home</a>
                        <a class="navbar-item" href="https://www.rmedgar.com/blog">Blog</a>
                        <a class="navbar-item" href="https://www.rmedgar.com/projects">Projects</a>
                        <a class="navbar-item" href="https://www.rmedgar.com/academic">Academic</a>
                        <a class="navbar-item" href="https://www.rmedgar.com/about">About me</a>
                        <a class="navbar-item" href="https://www.rmedgar.com/privacy">Privacy</a>
                </div>
            </div>
        </div>
    </nav>

    <section class="section">
<div class="container">
    <article class="post">
        <h2 class="title is-2">
            <a href="https://www.rmedgar.com/blog/using-rpi-zero-as-keyboard-send-reports">Using RPi Zero as a Keyboard Part 3: Sending and receiving reports</a>
        </h2>

        <div class="columns">
            <div class="column is-4">
                    <span>
                        <a href="https://www.rmedgar.com/blog/by/rmed">rmed</a>
                    </span>
            </div>
            <div class="column is-4 is-offset-4 has-text-right">
                <span><i>2017-07-13 11:40</i></span>
            </div>
        </div>

        <div class="content">
            <p>In this third and last part of the series we will use the
 new keyboard to send keystrokes to the connected computer. To do this, I
 will provide a couple of examples using Bash and Python, although they 
can be easily translated to other languages.</p>
<!--aka-break-->

<p><strong>Edited July 8, 2018</strong>: Tested on Raspbian Stretch (lite) 2018-06-27. Added <code>null</code> character in between the <code>ll</code> in <code>Hello</code>.</p>
<hr>
<h2>Index</h2>
<ol>
<li><a href="https://www.rmedgar.com/blog/using-rpi-zero-as-keyboard-setup-and-device-definition">Setup and device definition</a></li>
<li><a href="https://www.rmedgar.com/blog/using-rpi-zero-as-keyboard-report-descriptor">Report descriptor</a></li>
<li><a href="https://www.rmedgar.com/blog/using-rpi-zero-as-keyboard-send-reports">Sending and receiving reports</a> (this post)</li>
</ol>
<hr>
<h2>Input reports</h2>
<p>Input reports are those sent from the keyboard to the computer. As we saw in the <a href="https://www.rmedgar.com/blog/using-rpi-zero-as-keyboard-report-descriptor">previous post</a>, input reports for keyboards are 8 bytes long:</p>
<ul>
<li><strong>1 byte</strong>: modifier keys (Control, Shift, Alt, etc.), where each bit corresponds to a key</li>
<li><strong>1 byte</strong>: unused/reserved for OEM</li>
<li><strong>6 bytes</strong>: pressed key codes</li>
</ul>
<p>In order to press a regular key (e.g. <code>A</code> or <code>B</code>), its code has to be included inside the <strong>6 byte</strong> segment. Remember that this segment represents the <strong>pressed keys</strong>, so until a key stops appearing there the host will keep pressing that key constantly.</p>
<p>The modifier keys, however, are <strong>1 bit each</strong>. The modifier byte has the following structure (bit 0 is on the rightmost part):</p>
<div class="highlight"><pre><span></span><code>[Right Meta | Right Alt | Right Shift | Right Control | Left Meta | Left Alt | Left Shift | Left Control]
</code></pre></div>


<p>If a given bit is set to <code>1</code>, then the modifier key in question is pressed.</p>
<p>Now, as an example, let's write <code>Hello World!</code> with the virtual keyboard. Note that the device, once activated as shown in the <a href="https://www.rmedgar.com/blog/using-rpi-zero-as-keyboard-setup-and-device-definition">first post</a> (and having connected the Pi to a computer through the data port), will be accessible from the path <code>/dev/hidg0</code> and can be interacted with like a normal file.</p>
<p>For example, in bash:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/bin/bash</span>

<span class="k">function</span> write_report <span class="o">{</span>
    <span class="nb">echo</span> -ne <span class="nv">$1</span> &gt; /dev/hidg0
<span class="o">}</span>

<span class="c1"># H (press shift and H)</span>
write_report <span class="s2">"\x20\0\xb\0\0\0\0\0"</span>

<span class="c1"># e</span>
write_report <span class="s2">"\0\0\x8\0\0\0\0\0"</span>

<span class="c1"># ll</span>
write_report <span class="s2">"\0\0\xf\0\0\0\0\0"</span>
write_report <span class="s2">"\0\0\0\0\0\0\0\0"</span>
write_report <span class="s2">"\0\0\xf\0\0\0\0\0"</span>

<span class="c1"># o</span>
write_report <span class="s2">"\0\0\x12\0\0\0\0\0"</span>

<span class="c1"># SPACE</span>
write_report <span class="s2">"\0\0\x2c\0\0\0\0\0"</span>

<span class="c1"># W (press shift and W)</span>
write_report <span class="s2">"\x20\0\x1a\0\0\0\0\0"</span>

<span class="c1"># o</span>
write_report <span class="s2">"\0\0\x12\0\0\0\0\0"</span>

<span class="c1"># r</span>
write_report <span class="s2">"\0\0\x21\0\0\0\0\0"</span>

<span class="c1"># l</span>
write_report <span class="s2">"\0\0\xf\0\0\0\0\0"</span>

<span class="c1"># d</span>
write_report <span class="s2">"\0\0\x7\0\0\0\0\0"</span>

<span class="c1"># ! (press shift and 1)</span>
write_report <span class="s2">"\x20\0\x1e\0\0\0\0\0"</span>

<span class="c1"># Release al keys</span>
write_report <span class="s2">"\0\0\0\0\0\0\0\0"</span>
</code></pre></div>


<p>And for Python (3):</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>

<span class="n">NULL_CHAR</span> <span class="o">=</span> <span class="nb">chr</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">write_report</span><span class="p">(</span><span class="n">report</span><span class="p">):</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'/dev/hidg0'</span><span class="p">,</span> <span class="s1">'rb+'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
        <span class="n">fd</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">report</span><span class="o">.</span><span class="n">encode</span><span class="p">())</span>


<span class="c1"># H (press shift and H)</span>
<span class="n">write_report</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">+</span><span class="n">NULL_CHAR</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">11</span><span class="p">)</span><span class="o">+</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># e</span>
<span class="n">write_report</span><span class="p">(</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span><span class="o">+</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># ll</span>
<span class="n">write_report</span><span class="p">(</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">+</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>
<span class="n">write_report</span><span class="p">(</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
<span class="n">write_report</span><span class="p">(</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">+</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># o</span>
<span class="n">write_report</span><span class="p">(</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span><span class="o">+</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># SPACE</span>
<span class="n">write_report</span><span class="p">(</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">44</span><span class="p">)</span><span class="o">+</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># W (press shift and W)</span>
<span class="n">write_report</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">+</span><span class="n">NULL_CHAR</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">26</span><span class="p">)</span><span class="o">+</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># o</span>
<span class="n">write_report</span><span class="p">(</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">18</span><span class="p">)</span><span class="o">+</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># r</span>
<span class="n">write_report</span><span class="p">(</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">21</span><span class="p">)</span><span class="o">+</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># l</span>
<span class="n">write_report</span><span class="p">(</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">15</span><span class="p">)</span><span class="o">+</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># d</span>
<span class="n">write_report</span><span class="p">(</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">2</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">7</span><span class="p">)</span><span class="o">+</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># ! (press shift and 1)</span>
<span class="n">write_report</span><span class="p">(</span><span class="nb">chr</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span><span class="o">+</span><span class="n">NULL_CHAR</span><span class="o">+</span><span class="nb">chr</span><span class="p">(</span><span class="mi">30</span><span class="p">)</span><span class="o">+</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Release all keys</span>
<span class="n">write_report</span><span class="p">(</span><span class="n">NULL_CHAR</span><span class="o">*</span><span class="mi">8</span><span class="p">)</span>
</code></pre></div>


<p>Note that both examples may require <strong>superuser permissions</strong>
 in order to access the device file, and that the key codes must be sent
 in binary format. Also note that the only report that explicitly 
release the keys is the last one, as that is when we end writing and no 
more keys are going to be pressed.</p>
<h2>Output reports</h2>
<p>Output reports are sent from the host to the keyboard in order to set LED states. These reports are <strong>1 byte</strong> long and each bit represents the state of a single LED. Their structure is as follows:</p>
<div class="highlight"><pre><span></span><code>[CONSTANT | CONSTANT | CONSTANT | Kana | Compose | Scroll Lock | Caps Lock | Num Lock]
</code></pre></div>


<p>Take into account that these may not only be sent when pressing keys such as <code>Num Lock</code>.
 For instance, when dealing with virtual machines, the host will change 
the state of the LEDs depending on the state in the main operating 
system or the operating system inside the virtual machine.</p>
<p>A very simple example of reading an output report in Python (3) is as follows:</p>
<div class="highlight"><pre><span></span><code><span class="ch">#!/usr/bin/env python3</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">'/dev/hidg0'</span><span class="p">,</span> <span class="s1">'rb+'</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
    <span class="c1"># Read only 1 byte</span>
    <span class="n">output</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div>


<h2>Final note</h2>
<p>I hope this short series of posts was somewhat useful. Having the 
Raspberry Pi Zero act as a USB device, in this case a HID such as a 
keyboard, offers many different possibilities such as automated testing,
 fast shortcuts, or device prototyping. That, together with the fact 
that it is such a low-cost board and the multiple periferials and 
components available, make it a great base for many different types of 
projects.</p>
<p>Here I've only covered the basis of a keyboard (HID) gadget, but 
there are many types available that seem as interesting and worth 
looking at. This is only the beginning!</p>
<h2>Post series index</h2>
<ol>
<li><a href="https://www.rmedgar.com/blog/using-rpi-zero-as-keyboard-setup-and-device-definition">Setup and device definition</a></li>
<li><a href="https://www.rmedgar.com/blog/using-rpi-zero-as-keyboard-report-descriptor">Report descriptor</a></li>
<li><a href="https://www.rmedgar.com/blog/using-rpi-zero-as-keyboard-send-reports">Sending and receiving reports</a> (this post)</li>
</ol>
        </div>

        <div class="is-divider"></div>
        <div class="tags are-normal">
                <span class="tag is-info is-light is">
                    <a href="https://www.rmedgar.com/blog/tagged/descriptor">descriptor</a>
                </span>
                <span class="tag is-info is-light is">
                    <a href="https://www.rmedgar.com/blog/tagged/hid">hid</a>
                </span>
                <span class="tag is-info is-light is">
                    <a href="https://www.rmedgar.com/blog/tagged/input">input</a>
                </span>
                <span class="tag is-info is-light is">
                    <a href="https://www.rmedgar.com/blog/tagged/keyboard">keyboard</a>
                </span>
                <span class="tag is-info is-light is">
                    <a href="https://www.rmedgar.com/blog/tagged/keys">keys</a>
                </span>
                <span class="tag is-info is-light is">
                    <a href="https://www.rmedgar.com/blog/tagged/linux">linux</a>
                </span>
                <span class="tag is-info is-light is">
                    <a href="https://www.rmedgar.com/blog/tagged/output">output</a>
                </span>
                <span class="tag is-info is-light is">
                    <a href="https://www.rmedgar.com/blog/tagged/pi">pi</a>
                </span>
                <span class="tag is-info is-light is">
                    <a href="https://www.rmedgar.com/blog/tagged/raspberry-pi">raspberry pi</a>
                </span>
                <span class="tag is-info is-light is">
                    <a href="https://www.rmedgar.com/blog/tagged/report">report</a>
                </span>
                <span class="tag is-info is-light is">
                    <a href="https://www.rmedgar.com/blog/tagged/rpi">rpi</a>
                </span>
                <span class="tag is-info is-light is">
                    <a href="https://www.rmedgar.com/blog/tagged/zero">zero</a>
                </span>
        </div>

    </article>

        <div id="comments" class="mt-4">

    <section id="remark42"><iframe src="Tutorial-Part-3-Sending-and-receiving-reports_files/iframe.html" name="{&quot;__colors__&quot;:{}}" allowtransparency="true" scrolling="no" tabindex="0" title="Comments | Remark42" horizontalscrolling="no" verticalscrolling="no" style="width: 1px !important; min-width: 100% !important; border: medium none !important; overflow: hidden !important; margin: -6px; height: 4599px;" width="100%" frameborder="0"></iframe></section>

    <script>
        var remark_config = {
            host: "https://comments.rmedgar.com",
            site_id: "www.rmedgar.com",
            components: ["embed",],
            url: "https://www.rmedgar.com/blog/using-rpi-zero-as-keyboard-send-reports",
            max_shown_comments: 15,
            theme: "light",
            page_title: "Using RPi Zero as a Keyboard Part 3: Sending and receiving reports",
            show_email_subscription: true
        };

        (function(c) {
            for(var i = 0; i < c.length; i++){
                var d = document, s = d.createElement('script');
                s.src = remark_config.host + '/web/' +c[i] +'.js';
                s.defer = true;
                (d.head || d.body).appendChild(s);
            }
        })(remark_config.components || ['embed']);
    </script>
        </div>
</div>
    </section>

    <footer class="footer">
        <div class="container">
            <div class="columns">
                <div id="left-footer" class="column is-4">
                    <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="Tutorial-Part-3-Sending-and-receiving-reports_files/88x31.png"></a><br>Unless otherwise specified, this work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-sa/4.0/">Creative Commons Attribution-ShareAlike 4.0 International License</a>.
                </div>
                <div id="right-footer" class="column is-4 is-offset-4">
                </div>
            </div>
        </div>
    </footer>


</body></html>